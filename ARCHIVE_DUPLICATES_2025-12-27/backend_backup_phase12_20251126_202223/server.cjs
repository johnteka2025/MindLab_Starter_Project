/**








 * MindLab backend (CommonJS)








 * - Health endpoint:        GET /health








 * - Puzzles endpoint:       GET /puzzles








 * - Progress endpoint:      GET /progress, POST /progress








 * - Frontend static files:  GET /app  (serves built index.html)








 */

















const express = require("express");








const cors = require("cors");








const path = require("path");


const { createDailyChallengeRouter } = require("./daily-challenge/dailyChallengeRoutes.cjs");

















// ----------------------








// Basic app + middleware








// ----------------------








const app = express();

















// Allow frontend (local or Render) to call the API








app.use(cors());








app.use(express.json());
app.use(createDailyChallengeRouter());

















// Helper to log simple requests








app.use((req, res, next) => {








  console.log(`[${new Date().toISOString()}] ${req.method} ${req.url}`);








  next();








});

















// ----------------------








// In-memory progress store








// ----------------------








let progressState = {








  total: 2,








  solved: 0,








};

















// ----------------------








// Health endpoint








// ----------------------








app.get("/health", (req, res) => {








  res.json({








    ok: true,








    status: "ok",








    message: "MindLab backend is healthy",








    timestamp: new Date().toISOString(),








  });








});

















// ----------------------








// Puzzles endpoint








// ----------------------








const PUZZLES = [








  {








    id: 1,








    question: "What is 2 + 2?",








    options: ["3", "4", "5"],








    correctIndex: 1, // "4"








  },








  {








    id: 2,








    question: "What is the color of the sky?",








    options: ["Blue", "Green", "Red"],








    correctIndex: 0, // "Blue"








  },








];

















app.get("/puzzles", (req, res) => {








  res.json(PUZZLES);








});

















// ----------------------








// Progress endpoints








// ----------------------








app.get("/progress", (req, res) => {








  res.json(progressState);








});

















app.post("/progress", (req, res) => {








  const { solved } = req.body || {};








  if (typeof solved === "number" && solved >= 0) {








    progressState.solved = solved;








  }








  res.json(progressState);








});

















// ----------------------








// Serve frontend build








// ----------------------








const staticDir = path.join(__dirname, "..", "static");

















// Serve static assets (JS/CSS/images)








app.use(express.static(staticDir));

















// SPA entrypoint at /app








app.get("/app", (req, res) => {








  res.sendFile(path.join(staticDir, "index.html"));








});

















// Simple root message








app.get("/", (req, res) => {








  res.type("text/plain").send("MindLab backend is running");








});

















// ----------------------








// Start server








// ----------------------








const PORT = process.env.PORT || 8085;








// 0.0.0.0 is required for Docker/Render to be reachable








const HOST = "0.0.0.0";

















app.listen(PORT, HOST, () => {








  console.log(`MindLab backend running on ${PORT}`);








});









