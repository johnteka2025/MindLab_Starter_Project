[CmdletBinding()]
param()

$ErrorActionPreference = "Stop"

Write-Host "=== MindLab daily start (routine + UI test) ===" -ForegroundColor Cyan

$projectRoot = "C:\Projects\MindLab_Starter_Project"

if (-not (Test-Path $projectRoot)) {
    Write-Host "[ERROR] Project root not found: $projectRoot" -ForegroundColor Red
    exit 1
}

Push-Location $projectRoot
try {
    # ------------------------------------------------
    # STEP 1 — Run the main MindLab daily routine
    # ------------------------------------------------
    $dailyScript = Join-Path $projectRoot "run_mindlab_daily_routine.ps1"

    if (Test-Path $dailyScript) {
        Write-Host "[STEP 1] Running MindLab daily routine..." -ForegroundColor Yellow
        & $dailyScript
        $routineExit = $LASTEXITCODE
    }
    else {
        Write-Host "[WARN] Daily routine script not found: $dailyScript" -ForegroundColor Yellow
        $routineExit = 0
    }

    if ($routineExit -ne 0) {
        Write-Host "[ERROR] Daily routine FAILED with exit code $routineExit." -ForegroundColor Red
        exit $routineExit
    }

    Write-Host "[OK] Daily routine completed successfully." -ForegroundColor Green

    # ------------------------------------------------
    # STEP 2 — Run the Daily UI Playwright test
    # ------------------------------------------------
    $uiScript = Join-Path $projectRoot "run_daily_ui_test.ps1"

    if (Test-Path $uiScript) {
        Write-Host "[STEP 2] Running Daily UI Playwright test..." -ForegroundColor Yellow
        & $uiScript
        $uiExit = $LASTEXITCODE

        if ($uiExit -ne 0) {
            Write-Host "[WARN] Daily UI test FAILED with exit code $uiExit." -ForegroundColor Yellow
        }
        else {
            Write-Host "[OK] Daily UI test PASSED." -ForegroundColor Green
        }
    }
    else {
        Write-Host "[WARN] Daily UI test script not found: $uiScript (skipping)." -ForegroundColor Yellow
    }

    # ------------------------------------------------
    # Final summary
    # ------------------------------------------------
    Write-Host "======================================================="
    Write-Host "[RESULT] Daily routine + Daily UI test run completed." -ForegroundColor Green
    Write-Host "You are clear to start new feature or development work."
    Write-Host "======================================================="
}
finally {
    Pop-Location
}
